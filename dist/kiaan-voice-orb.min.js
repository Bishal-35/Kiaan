!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.KiaanVoiceOrb=t():e.KiaanVoiceOrb=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.d(t,{default:()=>W});const a=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isDragging=!1,this.dragThreshold=5,this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.orbElement=null,this.clickHandler=null,this.orbSize=64,this.init()},t=[{key:"init",value:function(){this.orbElement=document.createElement("div"),this.orbElement.className="kiaan-voice-orb",this.orbElement.innerHTML='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M16 4C17.1046 4 18 4.89543 18 6V26C18 27.1046 17.1046 28 16 28C14.8954 28 14 27.1046 14 26V6C14 4.89543 14.8954 4 16 4Z" fill="white"/>\n      <path d="M8 12C9.10457 12 10 12.8954 10 14V18C10 19.1046 9.10457 20 8 20C6.89543 20 6 19.1046 6 18V14C6 12.8954 6.89543 12 8 12Z" fill="white"/>\n      <path d="M24 10C25.1046 10 26 10.8954 26 12V20C26 21.1046 25.1046 22 24 22C22.8954 22 22 21.1046 22 20V12C22 10.8954 22.8954 10 24 10Z" fill="white"/>\n    </svg>',this.setDefaultPosition(),this.orbElement.addEventListener("mousedown",this.handleDragStart.bind(this)),this.orbElement.addEventListener("touchstart",this.handleDragStart.bind(this),{passive:!1}),document.addEventListener("mousemove",this.handleDragMove.bind(this)),document.addEventListener("touchmove",this.handleDragMove.bind(this),{passive:!1}),document.addEventListener("mouseup",this.handleDragEnd.bind(this)),document.addEventListener("touchend",this.handleDragEnd.bind(this)),window.addEventListener("resize",this.handleResize.bind(this)),document.body.appendChild(this.orbElement)}},{key:"setDefaultPosition",value:function(){window.innerWidth,this.orbSize,window.innerHeight,this.orbSize,this.orbElement.style.right="20px",this.orbElement.style.bottom="20px",this.orbElement.style.left="auto",this.orbElement.style.top="auto"}},{key:"handleResize",value:function(){if("auto"!==this.orbElement.style.left){var e=this.orbElement.getBoundingClientRect(),t=e.left,n=e.top,i=window.innerWidth-this.orbSize,o=window.innerHeight-this.orbSize;t>i&&(t=i),n>o&&(n=o),this.orbElement.style.left="".concat(t,"px"),this.orbElement.style.top="".concat(n,"px")}}},{key:"handleDragStart",value:function(e){e.preventDefault();var t="touchstart"===e.type?e.touches[0]:e;this.startX=t.clientX,this.startY=t.clientY;var n=this.orbElement.getBoundingClientRect();this.offsetX=this.startX-n.left,this.offsetY=this.startY-n.top,this.isDragging=!1,this.hasMoved=!1}},{key:"handleDragMove",value:function(e){if(0!==this.startX||0!==this.startY){var t="touchmove"===e.type?e.touches[0]:e,n=t.clientX-this.startX,i=t.clientY-this.startY;if(!this.isDragging&&(Math.abs(n)>this.dragThreshold||Math.abs(i)>this.dragThreshold)&&(this.isDragging=!0,this.orbElement.classList.add("dragging")),this.isDragging){e.preventDefault(),this.hasMoved=!0;var o=t.clientX-this.offsetX,a=t.clientY-this.offsetY,r=window.innerWidth-this.orbSize,s=window.innerHeight-this.orbSize;o=Math.max(0,Math.min(r,o)),a=Math.max(0,Math.min(s,a)),this.orbElement.style.right="auto",this.orbElement.style.bottom="auto",this.orbElement.style.left="".concat(o,"px"),this.orbElement.style.top="".concat(a,"px")}}}},{key:"handleDragEnd",value:function(e){this.isDragging?this.orbElement.classList.remove("dragging"):!this.hasMoved&&this.clickHandler&&this.clickHandler(),this.startX=0,this.startY=0,this.isDragging=!1}},{key:"setClickHandler",value:function(e){this.clickHandler=e}},{key:"showOrb",value:function(){this.orbElement.classList.remove("panel-open")}},{key:"hideOrb",value:function(){this.orbElement.classList.add("panel-open")}}],t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,i,o,a){var s=i&&i.prototype instanceof l?i:l,d=Object.create(s.prototype);return c(d,"_invoke",function(n,i,o){var a,s,c,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,r}};function h(n,i){for(s=n,c=i,t=0;!u&&l&&!o&&t<d.length;t++){var o,a=d[t],h=p.p,f=a[2];n>3?(o=f===i)&&(s=a[4]||3,c=a[5]===e?a[3]:a[5],a[4]=3,a[5]=e):a[0]<=h&&((o=n<2&&h<a[1])?(s=0,p.v=i,p.n=a[1]):h<f&&(o=n<3||a[0]>i||i>f)&&(a[4]=n,a[5]=i,p.n=f,s=0))}if(o||n>1)return r;throw u=!0,i}return function(o,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&h(d,f),s=d,c=f;(t=s<2?e:c)||!u;){a||(s?s<3?(s>1&&(p.n=-1),h(s,c)):p.n=c:p.v=c);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(u=p.n<0)?c:n.call(i,p))!==r)break}catch(t){a=e,s=1,c=t}finally{l=1}}return{value:t,done:u}}}(n,o,a),!0),d}var r={};function l(){}function d(){}function u(){}t=Object.getPrototypeOf;var p=[][i]?t(t([][i]())):(c(t={},i,(function(){return this})),t),h=u.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,c(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return d.prototype=u,c(h,"constructor",u),c(u,"constructor",d),d.displayName="GeneratorFunction",c(u,o,"GeneratorFunction"),c(h),c(h,o,"Generator"),c(h,i,(function(){return this})),c(h,"toString",(function(){return"[object Generator]"})),(s=function(){return{w:a,m:f}})()}function c(e,t,n,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,i){if(t)o?o(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n;else{var a=function(t,n){c(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},c(e,t,n,i)}function l(e,t,n,i,o,a,r){try{var s=e[a](r),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function r(e){l(a,i,o,r,s,"next",e)}function s(e){l(a,i,o,r,s,"throw",e)}r(void 0)}))}}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function p(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}const h=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.config=n,this.conversationState={status:"disconnected",isListening:!1,isSpeaking:!1,error:null},this.transcript=[],this.micPermissionGranted=!1,this.isWaitingForMicPermission=!1,this.init()},t=[{key:"init",value:function(){var e=this;this.container.innerHTML="",this.createUI(),this.loadElevenLabsSDK().then((function(){e.initializeVoiceConversation()})).catch((function(t){e.handleError("Failed to load ElevenLabs SDK. Using fallback implementation.",t),e.initializeFallbackVoiceConversation()}))}},{key:"loadElevenLabsSDK",value:function(){return new Promise((function(e,t){if(window.ElevenLabs)e();else{var n=document.createElement("script");n.src="https://api.elevenlabs.io/v1/speech-to-speech/stream",n.async=!0,n.onload=function(){console.log("ElevenLabs SDK loaded successfully"),e()},n.onerror=function(){console.error("Failed to load ElevenLabs SDK"),t(new Error("Failed to load ElevenLabs SDK"))},document.head.appendChild(n)}}))}},{key:"createUI",value:function(){var e=this,t=document.createElement("div");t.className="kiaan-voice-chat-container";var n=document.createElement("div");n.className="kiaan-voice-status";var i=document.createElement("div");i.className="kiaan-status-indicator status-disconnected",this.statusIndicator=i;var o=document.createElement("div");o.className="kiaan-status-text",o.textContent="Disconnected",this.statusText=o,n.appendChild(i),n.appendChild(o);var a=document.createElement("div");a.className="kiaan-voice-messages",this.messagesArea=a;var r=document.createElement("div");r.className="kiaan-interim-transcription",r.style.display="none",this.interimDisplay=r;var s=document.createElement("button");s.className="kiaan-voice-control-button",s.textContent="Start Conversation",s.addEventListener("click",(function(){return e.toggleConversation()})),this.controlButton=s,t.appendChild(n),t.appendChild(a),t.appendChild(r),t.appendChild(s),this.container.appendChild(t),this.addStyles()}},{key:"addStyles",value:function(){var e=document.createElement("style");e.textContent="\n      .kiaan-voice-chat-container {\n        font-family: Arial, sans-serif;\n        max-width: 400px;\n        margin: 0 auto;\n        padding: 20px;\n        background: #f9f9f9;\n        border-radius: 8px;\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n      }\n      \n      .kiaan-voice-status {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 10px;\n      }\n      \n      .kiaan-status-indicator {\n        width: 10px;\n        height: 10px;\n        border-radius: 50%;\n        background: #ff3b3b;\n        margin-right: 10px;\n      }\n      \n      .kiaan-status-text {\n        font-size: 14px;\n        color: #333;\n      }\n      \n      .kiaan-voice-messages {\n        max-height: 300px;\n        overflow-y: auto;\n        margin-bottom: 10px;\n        padding: 10px;\n        background: #fff;\n        border-radius: 4px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .kiaan-message {\n        display: flex;\n        margin-bottom: 10px;\n      }\n      \n      .kiaan-message-avatar {\n        width: 30px;\n        height: 30px;\n        border-radius: 50%;\n        background: #007bff;\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-right: 10px;\n      }\n      \n      .kiaan-message-bubble {\n        max-width: 70%;\n        padding: 10px;\n        border-radius: 4px;\n        background: #e9ecef;\n        color: #333;\n        position: relative;\n      }\n      \n      .kiaan-message-bubble:after {\n        content: '';\n        position: absolute;\n        top: 10px;\n        left: 100%;\n        margin-left: 8px;\n        border-width: 5px;\n        border-style: solid;\n        border-color: transparent transparent transparent #e9ecef;\n      }\n      \n      .kiaan-interim-transcription {\n        font-size: 14px;\n        color: #666;\n        margin-bottom: 10px;\n      }\n      \n      .kiaan-voice-control-button {\n        width: 100%;\n        padding: 10px;\n        border: none;\n        border-radius: 4px;\n        background: #007bff;\n        color: white;\n        font-size: 16px;\n        cursor: pointer;\n        transition: background 0.3s ease;\n      }\n      \n      .kiaan-voice-control-button:hover {\n        background: #0056b3;\n      }\n      \n      .kiaan-mic-button {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #3a8ffe 0%, #9259fe 100%);\n        border: none;\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        box-shadow: 0 4px 12px rgba(59, 143, 254, 0.4);\n      }\n      \n      .kiaan-mic-button:hover {\n        transform: scale(1.05);\n        box-shadow: 0 6px 16px rgba(59, 143, 254, 0.6);\n      }\n      \n      .kiaan-mic-button.listening {\n        animation: pulse-recording 1.5s infinite;\n        background: linear-gradient(135deg, #ff3b3b 0%, #ff6e6e 100%);\n      }\n      \n      @keyframes pulse-recording {\n        0% {\n          box-shadow: 0 0 0 0 rgba(255, 59, 59, 0.7);\n        }\n        70% {\n          box-shadow: 0 0 0 10px rgba(255, 59, 59, 0);\n        }\n        100% {\n          box-shadow: 0 0 0 0 rgba(255, 59, 59, 0);\n        }\n      }\n      \n      .kiaan-status-indicator.status-connected {\n        background: #4CAF50;\n      }\n      \n      .kiaan-status-indicator.status-disconnected {\n        background: #9e9e9e;\n      }\n      \n      .kiaan-status-indicator.status-connecting {\n        background: #FFC107;\n        animation: blink 1s infinite;\n      }\n      \n      .kiaan-status-indicator.status-error {\n        background: #F44336;\n      }\n      \n      .kiaan-status-indicator.status-waiting {\n        background: #2196F3;\n        animation: blink 1s infinite;\n      }\n      \n      @keyframes blink {\n        0% { opacity: 0.4; }\n        50% { opacity: 1; }\n        100% { opacity: 0.4; }\n      }\n    ",document.head.appendChild(e)}},{key:"initializeFallbackVoiceConversation",value:function(){console.log("Using fallback voice conversation implementation"),this.initializeSpeechRecognition(),this.voiceStream=null,this.handleTranscript({role:"assistant",content:"I'm using a simplified voice conversation mode. How can I help you today?"}),this.updateStatus("disconnected","Ready to start. Click the button below.")}},{key:"initializeVoiceConversation",value:function(){var e=this;if(window.ElevenLabs)try{var t,n,i=(null===(t=this.config)||void 0===t||null===(t=t.agents)||void 0===t?void 0:t.chat)||{},o=null===(n=this.config)||void 0===n||null===(n=n.elevenlabs)||void 0===n?void 0:n.api_key;console.log("Initializing ElevenLabs with agent ID:",i.id),console.log("Using voice ID:",i.voice_id||"default"),this.voiceStream=new window.ElevenLabs.SpeechStream({apiKey:o,voiceId:i.voice_id||"21m00Tcm4TlvDq8ikWAM",stability:.5,similarityBoost:.8,style:0,useSSML:!1,onStarted:function(){console.log("ElevenLabs stream started"),e.conversationState.isSpeaking=!0,e.updateStatus("connected","Assistant is speaking..."),e.updateUIForStatus()},onStopped:function(){console.log("ElevenLabs stream stopped"),e.conversationState.isSpeaking=!1,e.updateStatus("connected","Ready for your response"),e.updateUIForStatus()},onError:function(t){console.error("ElevenLabs stream error:",t),e.handleError("Error in voice stream: "+t.message)}}),this.initializeSpeechRecognition(),this.updateStatus("disconnected","Ready to start. Click the button below.")}catch(e){console.error("Failed to initialize ElevenLabs voice stream:",e),this.handleError("Failed to initialize ElevenLabs voice. Using fallback implementation."),this.initializeFallbackVoiceConversation()}else console.warn("ElevenLabs SDK not available. Using fallback."),this.initializeFallbackVoiceConversation()}},{key:"initializeSpeechRecognition",value:function(){var e=this;if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){var t=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new t,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onstart=function(){e.conversationState.isListening=!0,e.updateStatus("connected","Listening...")},this.recognition.onend=function(){e.conversationState.isListening=!1,e.updateStatus("connected","Processing...")},this.recognition.onresult=function(t){var n=Array.from(t.results).map((function(e){return e[0].transcript})).join("");t.results[0].isFinal?(e.updateInterimTranscription(""),e.handleTranscript({role:"user",content:n}),e.processWithElevenLabs(n)):e.updateInterimTranscription(n)},this.recognition.onerror=function(t){e.handleError("Speech recognition error: ".concat(t.error))}}else this.handleError("Speech recognition not supported in this browser"),this.controlButton.disabled=!0}},{key:"processWithElevenLabs",value:function(e){var t=this;if(this.voiceStream){this.conversationState.isSpeaking=!0,this.updateStatus("connected","Processing your request..."),this.updateUIForStatus();try{var n,i={text:e,modelId:(null===(n=this.config)||void 0===n||null===(n=n.elevenlabs)||void 0===n?void 0:n.model_id)||"eleven_turbo_v2",voiceSettings:{stability:.5,similarityBoost:.8}};this.voiceStream.start(i).then((function(e){e&&e.text&&t.handleTranscript({role:"assistant",content:e.text})})).catch((function(n){console.error("ElevenLabs API error:",n),t.handleError("Failed to process with ElevenLabs API: "+n.message),t.generateLocalResponse(e)}))}catch(t){console.error("Error submitting text to ElevenLabs:",t),this.handleError("Failed to process with ElevenLabs: "+t.message),this.generateLocalResponse(e)}}else this.generateLocalResponse(e)}},{key:"generateLocalResponse",value:function(e){var t=this;setTimeout((function(){var e=["I understand what you're saying. How can I help you further?","That's interesting. Let me think about that for a moment.","I appreciate your input. Is there anything specific you'd like to know?","Thanks for sharing that. Would you like me to elaborate on any particular aspect?","I've processed your message. What would you like me to do next?"],n=e[Math.floor(Math.random()*e.length)];t.handleTranscript({role:"assistant",content:n}),t.speakResponse(n)}),1e3)}},{key:"toggleConversation",value:(o=d(s().m((function e(){return s().w((function(e){for(;;)switch(e.n){case 0:"connected"===this.conversationState.status||this.conversationState.isListening?this.stopConversation():this.startConversation();case 1:return e.a(2)}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"startConversation",value:(i=d(s().m((function e(){var t;return s().w((function(e){for(;;)switch(e.n){case 0:return this.updateStatus("connecting","Connecting..."),this.controlButton.disabled=!0,e.p=1,this.isWaitingForMicPermission=!0,e.n=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:e.v.getTracks().forEach((function(e){return e.stop()})),this.micPermissionGranted=!0,this.isWaitingForMicPermission=!1,this.voiceStream?(console.log("Starting ElevenLabs conversation"),this.voiceStream.start(),this.recognition&&this.recognition.start(),this.controlButton.textContent="End Conversation",this.updateStatus("connected","Conversation started")):this.recognition&&(this.recognition.start(),this.updateStatus("connected","Listening..."),this.controlButton.textContent="End Conversation"),e.n=4;break;case 3:e.p=3,t=e.v,this.isWaitingForMicPermission=!1,this.handleError("Error starting conversation: "+(t.message||"Microphone access denied"),t),this.updateStatus("error","Failed to start: "+(t.message||"Microphone access denied"));case 4:return e.p=4,this.controlButton.disabled=!1,e.f(4);case 5:return e.a(2)}}),e,this,[[1,3,4,5]])}))),function(){return i.apply(this,arguments)})},{key:"stopConversation",value:function(){try{this.voiceStream&&this.voiceStream.stop(),this.recognition&&this.recognition.stop(),window.speechSynthesis&&window.speechSynthesis.cancel(),this.updateInterimTranscription(""),this.controlButton.textContent="Start Conversation",this.updateStatus("disconnected","Conversation ended")}catch(e){this.handleError("Error stopping conversation",e)}}},{key:"handleTranscript",value:function(e){this.transcript.push(e);var t=document.createElement("div");t.className="kiaan-message ".concat(e.role,"-message");var n=document.createElement("div");n.className="kiaan-message-avatar",n.textContent="user"===e.role?"U":"AI";var i=document.createElement("div");i.className="kiaan-message-bubble",i.textContent=e.content,t.appendChild(n),t.appendChild(i),this.messagesArea.appendChild(t),this.messagesArea.scrollTop=this.messagesArea.scrollHeight}},{key:"updateInterimTranscription",value:function(e){if(!e)return this.interimDisplay.style.display="none",void(this.interimDisplay.textContent="");this.interimDisplay.style.display="block",this.interimDisplay.textContent=e,this.messagesArea.scrollTop=this.messagesArea.scrollHeight}},{key:"updateStatus",value:function(e,t){this.conversationState.status=e,this.statusText.textContent=t,this.statusIndicator.className="kiaan-status-indicator status-".concat(e),this.updateUIForStatus()}},{key:"updateUIForStatus",value:function(){"connected"===this.conversationState.status||this.conversationState.isListening?this.controlButton.textContent="End Conversation":"connecting"===this.conversationState.status||this.isWaitingForMicPermission?(this.controlButton.textContent="Connecting...",this.controlButton.disabled=!0):(this.controlButton.textContent="Start Conversation",this.controlButton.disabled=!1),this.conversationState.isSpeaking?(this.statusText.textContent="Assistant is speaking...",this.statusIndicator.className="kiaan-status-indicator status-connected"):this.conversationState.isListening&&(this.statusText.textContent="Listening...",this.statusIndicator.className="kiaan-status-indicator status-waiting")}},{key:"handleError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.error("Voice Chat Error:",e,t),this.conversationState.error=e,this.updateStatus("error","Error: ".concat(e)),this.controlButton.disabled=!1}},{key:"destroy",value:function(){if(this.voiceStream)try{this.voiceStream.stop()}catch(e){console.error("Error stopping voice stream:",e)}if(this.recognition)try{this.recognition.stop()}catch(e){console.error("Error stopping recognition:",e)}}},{key:"speakResponse",value:function(e){var t=this;if("speechSynthesis"in window){this.conversationState.isSpeaking=!0,this.updateStatus("connected","Assistant is speaking...");var n=new SpeechSynthesisUtterance(e),i=window.speechSynthesis.getVoices();0===i.length?window.speechSynthesis.onvoiceschanged=function(){i=window.speechSynthesis.getVoices(),t.setVoiceForUtterance(n,i)}:this.setVoiceForUtterance(n,i),n.onstart=function(){console.log("Speech started"),t.conversationState.isSpeaking=!0,t.updateUIForStatus()},n.onend=function(){console.log("Speech ended"),t.conversationState.isSpeaking=!1,t.updateStatus("connected","Ready for your response"),t.updateUIForStatus()},n.onerror=function(e){console.error("Speech synthesis error:",e),t.conversationState.isSpeaking=!1,t.updateUIForStatus()},window.speechSynthesis.speak(n)}else console.warn("Speech synthesis not supported in this browser")}},{key:"setVoiceForUtterance",value:function(e,t){var n=t.filter((function(e){return e.lang.includes("en")&&(e.name.includes("Female")||e.name.includes("Samantha")||e.name.includes("Google"))}));n.length>0&&(e.voice=n[0],console.log("Using voice:",n[0].name)),e.rate=1,e.pitch=1,e.volume=1}}],t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i,o}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return(t=y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,y(i.key),i)}}function y(e){var t=function(e,t){if("object"!=f(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=f(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==f(t)?t:t+""}function k(e,t,n){return t=S(t),function(e,t){if(t&&("object"==f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,w()?Reflect.construct(t,n||[],S(e).constructor):t.apply(e,n))}function w(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(w=function(){return!!e})()}function x(){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},x.apply(null,arguments)}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}const C=function(e){function t(e,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=k(this,t,[e,n]),n&&n.agents&&n.agents.meeting&&(i.config=g(g({},n),{},{agents:{chat:n.agents.meeting}})),i.customizeMeetingUI(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(t,e),n=t,i=[{key:"customizeMeetingUI",value:function(){var e=document.createElement("div");e.className="kiaan-meeting-header",e.innerHTML="\n      <h3>Meeting Assistant</h3>\n      <p>Use your voice to interact with the meeting assistant.</p>\n    ",this.container.insertBefore(e,this.container.firstChild),this.updateStatus("Meeting assistant ready. Click the microphone to start.")}},{key:"handleTranscript",value:function(e){var n,i,o,a,r;(n=t,i="handleTranscript",o=this,r=x(S(1&(a=3)?n.prototype:n),i,o),2&a&&"function"==typeof r?function(e){return r.apply(o,e)}:r)([e]),"assistant"===e.role&&this.extractMeetingData(e.content)}},{key:"extractMeetingData",value:function(e){console.log("Meeting data extracted:",e)}}],i&&b(n.prototype,i),o&&b(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,o}(h);function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function O(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,i,o,a){var c=i&&i.prototype instanceof s?i:s,l=Object.create(c.prototype);return P(l,"_invoke",function(n,i,o){var a,s,c,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,r}};function h(n,i){for(s=n,c=i,t=0;!u&&l&&!o&&t<d.length;t++){var o,a=d[t],h=p.p,f=a[2];n>3?(o=f===i)&&(s=a[4]||3,c=a[5]===e?a[3]:a[5],a[4]=3,a[5]=e):a[0]<=h&&((o=n<2&&h<a[1])?(s=0,p.v=i,p.n=a[1]):h<f&&(o=n<3||a[0]>i||i>f)&&(a[4]=n,a[5]=i,p.n=f,s=0))}if(o||n>1)return r;throw u=!0,i}return function(o,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&h(d,f),s=d,c=f;(t=s<2?e:c)||!u;){a||(s?s<3?(s>1&&(p.n=-1),h(s,c)):p.n=c:p.v=c);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(u=p.n<0)?c:n.call(i,p))!==r)break}catch(t){a=e,s=1,c=t}finally{l=1}}return{value:t,done:u}}}(n,o,a),!0),l}var r={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var d=[][i]?t(t([][i]())):(P(t={},i,(function(){return this})),t),u=l.prototype=s.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,P(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return c.prototype=l,P(u,"constructor",l),P(l,"constructor",c),c.displayName="GeneratorFunction",P(l,o,"GeneratorFunction"),P(u),P(u,o,"Generator"),P(u,i,(function(){return this})),P(u,"toString",(function(){return"[object Generator]"})),(O=function(){return{w:a,m:p}})()}function P(e,t,n,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}P=function(e,t,n,i){if(t)o?o(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n;else{var a=function(t,n){P(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},P(e,t,n,i)}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t,n){return(t=A(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t,n,i,o,a,r){try{var s=e[a](r),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,A(i.key),i)}}function A(e){var t=function(e,t){if("object"!=M(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=M(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==M(t)?t:t+""}const D=function(){return e=function e(t,n){var i,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.config=n,this.messages=[],this.isProcessing=!1,this.webhookUrl=(null==n||null===(i=n.webhooks)||void 0===i?void 0:i.text_chat)||null,this.uploadUrl=(null==n||null===(o=n.webhooks)||void 0===o?void 0:o.file_upload)||null,this.fileUploadSettings=(null==n?void 0:n.settings)||{max_file_size:10485760,allowed_file_types:[".jpg",".jpeg",".png",".pdf",".csv",".doc",".docx"]},this.pendingAttachments=[],this.devMode=(null==n?void 0:n.devMode)||!1,this.init()},t=[{key:"init",value:function(){this.container.innerHTML="",this.createUI()}},{key:"createUI",value:function(){var e=this,t=document.createElement("div");t.className="kiaan-text-chat-container";var n=document.createElement("div");n.className="kiaan-text-messages",this.messagesArea=n;var i=document.createElement("div");i.className="kiaan-attachment-preview",this.attachmentPreview=i;var o=document.createElement("div");o.className="kiaan-upload-progress-container",o.style.display="none";var a=document.createElement("div");a.className="kiaan-upload-progress";var r=document.createElement("div");r.className="kiaan-upload-progress-text",r.textContent="Uploading...",o.appendChild(a),o.appendChild(r),this.uploadProgressContainer=o,this.uploadProgress=a,this.uploadProgressText=r;var s=document.createElement("div");s.className="kiaan-text-input-area";var c=document.createElement("button");c.className="kiaan-attach-button",c.innerHTML='<svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"></path></svg>';var l=document.createElement("input");l.type="file",l.multiple=!0,l.style.display="none",l.accept=this.fileUploadSettings.allowed_file_types.join(","),l.addEventListener("change",(function(){return e.handleFileSelection(l.files)})),this.fileInput=l,c.addEventListener("click",(function(){return l.click()}));var d=document.createElement("textarea");d.className="kiaan-text-input",d.placeholder="Type your message...",d.rows=1,d.addEventListener("keydown",(function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.sendMessage())})),d.addEventListener("input",this.autoResizeTextarea.bind(this)),this.textInput=d;var u=document.createElement("button");u.className="kiaan-send-button",u.innerHTML='<svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M2,21L23,12L2,3V10L17,12L2,14V21Z"></path></svg>',u.addEventListener("click",(function(){return e.sendMessage()})),this.sendButton=u,s.appendChild(c),s.appendChild(d),s.appendChild(u),t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(s),this.container.appendChild(t),this.container.appendChild(l),this.addStyles(),this.displaySystemMessage("How can I help you today?")}},{key:"addStyles",value:function(){var e=document.createElement("style");e.textContent="\n      .kiaan-text-chat-container {\n        background: #f9f9f9;  /* Light gray background */\n        font-family: Arial, sans-serif;\n        max-width: 400px;\n        margin: 0 auto;\n        padding: 20px;\n        border-radius: 8px;\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n      }\n      \n      .kiaan-text-messages {\n        background: #fff;  /* White background */\n        flex: 1;\n        overflow-y: auto;\n        margin-bottom: 10px;\n        padding: 10px;\n        border-radius: 4px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .kiaan-message {\n        display: flex;\n        margin-bottom: 10px;\n      }\n      \n      .kiaan-message-avatar {\n        background: #007bff;  /* Default blue */\n        color: white;\n        width: 30px;\n        height: 30px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-right: 10px;\n        flex-shrink: 0;\n        font-weight: bold;\n        font-size: 12px;\n      }\n      \n      .user-message .kiaan-message-avatar {\n        background:rgb(0, 0, 0);  /* Gray for user */\n      }\n      \n      .assistant-message .kiaan-message-avatar {\n        background: #28a745;  /* Green for AI */\n      }\n      \n      .system-message .kiaan-message-avatar {\n        background: #17a2b8;  /* Teal for system */\n      }\n      \n      .kiaan-message-bubble {\n        background:rgb(0, 0, 0);  /* Light gray bubble */\n        color: #212529;       /* Dark text */\n        max-width: 70%;\n        padding: 10px;\n        border-radius: 4px;\n        position: relative;\n        word-wrap: break-word;\n        line-height: 1.4;\n      }\n      \n      .user-message .kiaan-message-bubble {\n        background: #007bff;  /* Blue bubble for user */\n        color: #ffffff;       /* White text */\n      }\n      \n      .assistant-message .kiaan-message-bubble {\n        background: #f8f9fa;  /* Very light gray for AI */\n        color: #212529;       /* Dark text */\n        border: 1px solid #dee2e6;  /* Light border */\n      }\n      \n      .system-message .kiaan-message-bubble {\n        background: #d1ecf1;  /* Light blue for system */\n        color: #0c5460;       /* Dark teal text */\n        border: 1px solid #bee5eb;  /* Light blue border */\n      }\n      \n      .kiaan-text-input-area {\n        background: #000;     /* White input area */\n        display: flex;\n        align-items: center;\n        border-radius: 4px;\n        padding: 5px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .kiaan-text-input {\n        color: #212529;       /* Dark text in input */\n        background: transparent;\n        flex: 1;\n        border: none;\n        padding: 8px;\n        resize: none;\n        font-family: inherit;\n        font-size: 14px;\n        outline: none;\n      }\n      \n      .kiaan-text-input::placeholder {\n        color: rgb(0, 0, 0);  /* BLACK placeholder text - THIS IS THE ISSUE */\n      }\n      \n      .kiaan-attach-button, .kiaan-send-button {\n        background: #000;\n        border: none;\n        cursor: pointer;\n        padding: 8px;\n        border-radius: 4px;\n        transition: all 0.2s;\n      }\n      \n      .kiaan-attach-button:hover, .kiaan-send-button:hover {\n        color: #0056b3;       /* Darker blue on hover */\n        background: #f8f9fa;  /* Light gray background on hover */\n      }\n      \n      .kiaan-attach-button:disabled, .kiaan-send-button:disabled {\n        color: #6c757d;\n        cursor: not-allowed;\n      }\n      \n      .kiaan-attachment-preview {\n        display: none;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin-bottom: 10px;\n      }\n      \n      .kiaan-attachment {\n        display: flex;\n        align-items: center;\n        background: #000;\n        border-radius: 4px;\n        padding: 5px 10px;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n        max-width: 200px;\n      }\n      \n      .kiaan-attachment-icon {\n        width: 30px;\n        height: 30px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background:rgb(0, 0, 0);\n        border-radius: 4px;\n        margin-right: 8px;\n        overflow: hidden;\n      }\n      \n      .kiaan-attachment-icon img {\n        max-width: 100%;\n        max-height: 100%;\n      }\n      \n      .kiaan-attachment-name {\n        flex: 1;\n        font-size: 12px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .kiaan-attachment-remove {\n        background: none;\n        border: none;\n        color: #dc3545;\n        cursor: pointer;\n        font-size: 16px;\n        margin-left: 5px;\n      }\n      \n      .kiaan-upload-progress-container {\n        margin-bottom: 10px;\n        background: #fff;\n        padding: 10px;\n        border-radius: 4px;\n      }\n      \n      .kiaan-upload-progress {\n        height: 5px;\n        background: #007bff;\n        width: 0%;\n        transition: width 0.3s;\n        border-radius: 2px;\n      }\n      \n      .kiaan-upload-progress-text {\n        font-size: 12px;\n        margin-top: 5px;\n        color: #6c757d;\n      }\n      \n      .kiaan-message-attachments {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin-top: 8px;\n      }\n      \n      .attachment-message {\n        font-size: 12px;\n        padding: 5px 8px;\n        background: rgba(255, 255, 255, 0.1);\n        border-radius: 3px;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n      \n      .user-message .attachment-message {\n        background: rgba(255, 255, 255, 0.2);\n        color: #ffffff;\n      }\n      \n      .assistant-message .attachment-message {\n        background: #e9ecef;\n        color: #495057;\n      }\n      \n      .kiaan-config-warning {\n        background-color: #fff3cd;\n        color: #856404;\n        padding: 10px;\n        border-radius: 4px;\n        margin: 10px 0;\n        font-size: 14px;\n        border: 1px solid #ffeaa7;\n      }\n      \n      .kiaan-typing-indicator {\n        display: flex;\n        align-items: center;\n      }\n      .kiaan-typing-indicator span {\n        height: 8px;\n        width: 8px;\n        background: #606060;\n        border-radius: 50%;\n        display: block;\n        margin: 0 2px;\n        opacity: 0.4;\n        animation: kiaan-typing 1s infinite;\n      }\n      .kiaan-typing-indicator span:nth-child(2) {\n        animation-delay: 0.2s;\n      }\n      .kiaan-typing-indicator span:nth-child(3) {\n        animation-delay: 0.4s;\n      }\n      @keyframes kiaan-typing {\n        0% { opacity: 0.4; transform: scale(1); }\n        50% { opacity: 1; transform: scale(1.2); }\n        100% { opacity: 0.4; transform: scale(1); }\n      }\n    ",document.head.appendChild(e)}},{key:"autoResizeTextarea",value:function(){var e=this.textInput;e.style.height="auto";var t=Math.min(Math.max(e.scrollHeight,24),100);e.style.height="".concat(t,"px")}},{key:"handleFileSelection",value:function(e){var t=this;if(e&&0!==e.length){var n=this.fileUploadSettings.allowed_file_types,i=this.fileUploadSettings.max_file_size,o=Array.from(e).filter((function(e){if(e.size>i)return t.showError('File "'.concat(e.name,'" exceeds maximum size of ').concat(Math.round(i/1024/1024),"MB")),!1;var o="."+e.name.split(".").pop().toLowerCase();return!!n.includes(o)||(t.showError('File type "'.concat(o,'" is not allowed')),!1)}));0!==o.length&&(o.forEach((function(e){return t.addFileToPreview(e)})),this.pendingAttachments.length>0&&(this.attachmentPreview.style.display="flex"))}}},{key:"addFileToPreview",value:function(e){var t=this,n=document.createElement("div");n.className="kiaan-attachment";var i=document.createElement("div");if(i.className="kiaan-attachment-icon",e.type.startsWith("image/")){var o=document.createElement("img"),a=new FileReader;a.onload=function(e){o.src=e.target.result},a.readAsDataURL(e),i.appendChild(o)}else{var r=e.name.split(".").pop().toUpperCase();i.textContent=r}var s=document.createElement("div");s.className="kiaan-attachment-name",s.textContent=e.name;var c=document.createElement("button");c.className="kiaan-attachment-remove",c.textContent="×",c.addEventListener("click",(function(){t.pendingAttachments=t.pendingAttachments.filter((function(t){return t.file!==e})),n.remove(),0===t.pendingAttachments.length&&(t.attachmentPreview.style.display="none")})),n.appendChild(i),n.appendChild(s),n.appendChild(c),this.attachmentPreview.appendChild(n),this.pendingAttachments.push({file:e,element:n})}},{key:"createMockResponse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(n){console.log("Development mode active - creating mock response",{message:e,fileCount:t.length}),setTimeout((function(){var i='This is a mock response to: "'.concat(e.content,'"');t.length>0&&(i+="\n\nI received ".concat(t.length," file(s):"),t.forEach((function(e,t){i+="\n- ".concat(t+1,". ").concat(e.name," (").concat(Math.round(e.size/1024)," KB)")}))),n({message:i,timestamp:(new Date).toISOString(),mock:!0})}),1500)}))}},{key:"sendToWebhook",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!this.webhookUrl)return this.devMode?(console.warn("No webhook URL configured, using mock response (dev mode)"),this.createMockResponse(e,n)):Promise.reject(new Error("Webhook URL not configured"));if(this.devMode&&(this.webhookUrl.includes("localhost")||this.webhookUrl.endsWith(".html")||this.webhookUrl.includes("/api/dummy/")||this.webhookUrl.includes("httpbin.org")))return console.warn("Development mode active - using mock response instead of webhook"),this.createMockResponse(e,n);var i=new FormData;return i.append("message",e.content),i.append("timestamp",e.timestamp),i.append("role",e.role),n.forEach((function(e,t){i.append("file_".concat(t),e)})),n.length>0&&(this.uploadProgressContainer.style.display="block",this.uploadProgress.style.width="0%",this.uploadProgressText.textContent="Sending message with ".concat(n.length," file(s)...")),new Promise((function(o,a){var r=new XMLHttpRequest;r.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var n=Math.round(e.loaded/e.total*100);t.uploadProgress.style.width="".concat(n,"%"),t.uploadProgressText.textContent="Uploading: ".concat(n,"%")}})),r.addEventListener("load",(function(){if(t.uploadProgressContainer.style.display="none",r.status>=200&&r.status<300){var i=r.getResponseHeader("Content-Type")||"";if(console.log("Webhook response:",{status:r.status,contentType:i,responseText:r.responseText.substring(0,200)+(r.responseText.length>200?"...":"")}),i.includes("application/json"))try{var s=JSON.parse(r.responseText);o(s)}catch(i){console.error("Error parsing JSON response:",i,"Response text:",r.responseText.substring(0,200)),t.devMode?(console.warn("Using mock response due to JSON parsing error"),t.createMockResponse(e,n).then(o)):a(new Error("Invalid JSON response from server"))}else if(i.includes("text/html"))console.warn("Server returned HTML instead of JSON. This typically indicates an error or misconfiguration."),t.devMode?(console.info("Development mode active - using mock response for HTML response"),t.createMockResponse(e,n).then(o)):o({message:"The server returned HTML instead of JSON. Please check your webhook configuration or enable development mode.",error:"html_response",fallback:!0});else try{var c=JSON.parse(r.responseText);o(c)}catch(i){t.devMode?(console.info("Development mode active - using mock response for non-JSON content"),t.createMockResponse(e,n).then(o)):o({message:r.responseText.substring(0,500)||"Server responded with non-JSON content",fallback:!0})}}else console.error("Server error response:",r.status,r.statusText,r.responseText.substring(0,200)),t.devMode?(console.warn("Using mock response due to server error"),t.createMockResponse(e,n).then(o)):a(new Error("Server responded with ".concat(r.status,": ").concat(r.statusText)))})),r.addEventListener("error",(function(){t.uploadProgressContainer.style.display="none",console.error("Network error during webhook request"),t.devMode?(console.warn("Using mock response due to network error"),t.createMockResponse(e,n).then(o)):a(new Error("Network error occurred"))})),r.addEventListener("abort",(function(){t.uploadProgressContainer.style.display="none",t.devMode?(console.warn("Using mock response due to aborted request"),t.createMockResponse(e,n).then(o)):a(new Error("Request was aborted"))})),r.open("POST",t.webhookUrl,!0),r.send(i)})).then((function(e){return console.log("Processed webhook response:",e),"html_response"===e.error&&e.fallback&&t.displayConfigurationWarning(),{content:e.message||e.response||(e.fallback?e.message:"No response received"),timestamp:(new Date).toISOString(),fallback:e.fallback||e.mock}})).catch((function(e){throw console.error("Error sending message:",e),e}))}},{key:"displayConfigurationWarning",value:function(){var e=document.createElement("div");e.className="kiaan-config-warning",e.innerHTML='\n      <div style="background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 14px;">\n        <strong>Configuration Issue Detected:</strong> The webhook URL is returning HTML instead of JSON.\n        <br><br>\n        <strong>Possible solutions:</strong>\n        <ul style="margin-top: 5px; padding-left: 20px;">\n          <li>Check that your webhook URL points to an API endpoint, not a webpage</li>\n          <li>Add <code>devMode: true</code> in your initialization config to use mock responses</li>\n          <li>Configure a proper webhook that returns JSON responses</li>\n        </ul>\n      </div>\n    ';var t=this.container.querySelector(".kiaan-text-input-area");t?t.parentNode.insertBefore(e,t):this.messagesArea.appendChild(e),this.textInput.addEventListener("focus",(function(){e.parentNode&&e.parentNode.removeChild(e)}),{once:!0})}},{key:"displayUserMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.displayMessage({role:"user",content:e,attachments:t})}},{key:"displayAssistantMessage",value:function(e){this.displayMessage({role:"assistant",content:e})}},{key:"displaySystemMessage",value:function(e){this.displayMessage({role:"system",content:e})}},{key:"displayMessage",value:function(e){var t=document.createElement("div");t.className="kiaan-message ".concat(e.role,"-message");var n=document.createElement("div");switch(n.className="kiaan-message-avatar",e.role){case"user":n.textContent="U";break;case"assistant":n.textContent="AI";break;case"system":n.textContent="S"}var i=document.createElement("div");if(i.className="kiaan-message-bubble",e.content){var o=document.createElement("div");o.textContent=e.content,i.appendChild(o)}if(e.attachments&&e.attachments.length>0){var a=document.createElement("div");a.className="kiaan-message-attachments",e.attachments.forEach((function(e){var t=document.createElement("div");t.className="kiaan-attachment attachment-message";var n="",i=e.type||e.mime||"";if(n=i.startsWith("image/")?'<svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z"></path></svg>':i.includes("pdf")?'<svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12,9H15V15H12V9M10,9H7V11H10V9M10,13H7V15H10V13M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"></path></svg>':'<svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"></path></svg>',t.innerHTML="\n          ".concat(n,"\n          <span>").concat(e.name||"Attachment","</span>\n        "),e.url){var o=document.createElement("a");o.href=e.url,o.target="_blank",o.appendChild(t),a.appendChild(o)}else a.appendChild(t)})),i.appendChild(a)}t.appendChild(n),t.appendChild(i),this.messagesArea.appendChild(t),this.messagesArea.scrollTop=this.messagesArea.scrollHeight}},{key:"showError",value:function(e){var t=document.createElement("div");t.className="kiaan-error-toast",t.textContent=e,t.style.position="absolute",t.style.bottom="60px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="rgba(255, 59, 59, 0.9)",t.style.color="white",t.style.padding="8px 16px",t.style.borderRadius="4px",t.style.zIndex="10000",this.container.appendChild(t),setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),3e3),console.error("Text Chat Error:",e)}},{key:"sendMessage",value:(i=O().m((function e(){var t,n,i,o,a,r,s,c,l,d,u,p,h,f=this;return O().w((function(e){for(;;)switch(e.n){case 0:if((t=this.textInput.value.trim())||0!==this.pendingAttachments.length){e.n=1;break}return e.a(2);case 1:return this.devMode&&console.log("Development mode is active - using mock responses"),n=t,this.textInput.value="",this.textInput.style.height="auto",this.isProcessing=!0,this.textInput.disabled=!0,this.sendButton.disabled=!0,e.p=2,i={content:n,role:"user",timestamp:(new Date).toISOString()},o=this.pendingAttachments.map((function(e){return e.file})),a=this.pendingAttachments.map((function(e){return{name:e.file.name,type:e.file.type,size:e.file.size}})),this.displayUserMessage(n,a),this.messages.push(T(T({},i),{},{attachments:a})),this.pendingAttachments=[],this.attachmentPreview.innerHTML="",this.attachmentPreview.style.display="none",(r=document.createElement("div")).className="kiaan-message assistant-message",r.innerHTML='\n        <div class="kiaan-message-avatar">AI</div>\n        <div class="kiaan-message-bubble" style="display: flex; align-items: center;">\n          <div class="kiaan-typing-indicator">\n            <span></span><span></span><span></span>\n          </div>\n        </div>\n      ',this.messagesArea.appendChild(r),this.messagesArea.scrollTop=this.messagesArea.scrollHeight,e.n=3,this.sendToWebhook(i,o);case 3:(s=e.v).fallback&&!this.devMode&&(console.warn("Webhook configuration issue detected. Auto-enabling development mode for better user experience."),this.devMode=!0,this.displaySystemMessage("Development mode has been automatically enabled due to webhook configuration issues. You will now receive mock responses.")),setTimeout((function(){r.remove();var e={content:s.content||"No response received",role:"assistant",timestamp:(new Date).toISOString()};f.messages.push(e),f.displayAssistantMessage(e.content)}),1e3),e.n=10;break;case 4:if(e.p=4,!((p=e.v).message.includes("HTML")||p.message.includes("Invalid JSON")||p.message.includes("Network error"))){e.n=9;break}return console.warn("Webhook error detected. Enabling development mode and retrying with mock response."),this.devMode=!0,this.displaySystemMessage("Webhook configuration issue detected. Development mode has been enabled. Retrying with mock response..."),e.p=5,c={content:n,role:"user",timestamp:(new Date).toISOString()},l=this.pendingAttachments.map((function(e){return e.file})),e.n=6,this.createMockResponse(c,l);case 6:d=e.v,u={content:d.message||"Mock response generated",role:"assistant",timestamp:(new Date).toISOString()},this.messages.push(u),this.displayAssistantMessage(u.content),e.n=8;break;case 7:e.p=7,h=e.v,this.showError("Failed to generate mock response: ".concat(h.message)),this.displaySystemMessage("Error: ".concat(h.message));case 8:e.n=10;break;case 9:this.showError("Failed to send message: ".concat(p.message)),console.error("Send message error:",p),this.displaySystemMessage("Error: ".concat(p.message));case 10:return e.p=10,this.isProcessing=!1,this.textInput.disabled=!1,this.sendButton.disabled=!1,this.textInput.focus(),e.f(10);case 11:return e.a(2)}}),e,this,[[5,7],[2,4,10,11]])})),o=function(){var e=this,t=arguments;return new Promise((function(n,o){var a=i.apply(e,t);function r(e){I(a,n,o,r,s,"next",e)}function s(e){I(a,n,o,r,s,"throw",e)}r(void 0)}))},function(){return o.apply(this,arguments)})}],t&&N(e.prototype,t),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i,o}();function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,H(i.key),i)}}function H(e){var t=function(e,t){if("object"!=V(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=V(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==V(t)?t:t+""}const U=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.panelContainer=null,this.panel=null,this.activeMode="voice-chat",this.config=null,this.modeInstances={},this.init()},t=[{key:"init",value:function(){var e=this;this.panelContainer=document.createElement("div"),this.panelContainer.className="kiaan-panel-container",this.panel=document.createElement("div"),this.panel.className="kiaan-panel";var t=document.createElement("div");t.className="kiaan-panel-header";var n=document.createElement("div");n.className="kiaan-panel-title",n.textContent="Kiaan Voice Assistant";var i=document.createElement("button");i.className="kiaan-panel-close",i.innerHTML="&times;",i.addEventListener("click",(function(){return e.close()})),t.appendChild(n),t.appendChild(i);var o=document.createElement("div");o.className="kiaan-panel-tabs";var a=[{id:"voice-chat",label:"Voice Chat"},{id:"meeting",label:"Meeting"},{id:"text-chat",label:"Text Chat"}];a.forEach((function(t){var n=document.createElement("div");n.className="kiaan-panel-tab ".concat(t.id===e.activeMode?"active":""),n.textContent=t.label,n.dataset.mode=t.id,n.onclick=function(n){return console.log("Tab clicked: ".concat(t.id)),n.preventDefault(),n.stopPropagation(),e.switchMode(t.id),!1},o.appendChild(n)}));var r=document.createElement("div");r.className="kiaan-panel-content",a.forEach((function(t){var n=document.createElement("div");n.className="kiaan-mode ".concat(t.id===e.activeMode?"active":""),n.id="kiaan-".concat(t.id,"-mode"),r.appendChild(n)})),this.panel.appendChild(t),this.panel.appendChild(o),this.panel.appendChild(r),this.panelContainer.appendChild(this.panel),document.body.appendChild(this.panelContainer),this.panelContainer.addEventListener("click",(function(t){t.target===e.panelContainer&&e.close()}))}},{key:"setConfig",value:function(e){console.log("Setting panel config:",e),this.config=e,e&&this.initializeMode(this.activeMode)}},{key:"initializeMode",value:function(e){console.log("Initializing mode: ".concat(e)),this.config||(console.log("No config available, using dummy config"),this.config={agents:{chat:{id:"test-chat-id",voice_id:"voice-id-a"},meeting:{id:"test-meeting-id",voice_id:"voice-id-b"}},webhooks:{text_chat:"/api/chat",file_upload:"/api/upload"}});var t=document.getElementById("kiaan-".concat(e,"-mode"));if(t){this.modeInstances[e]&&("function"==typeof this.modeInstances[e].destroy&&this.modeInstances[e].destroy(),delete this.modeInstances[e]);try{switch(e){case"voice-chat":console.log("Creating voice chat instance"),this.modeInstances[e]=new h(t,this.config);break;case"meeting":console.log("Creating meeting instance"),this.modeInstances[e]=new C(t,this.config);break;case"text-chat":console.log("Creating text chat instance"),this.modeInstances[e]=new D(t,this.config)}}catch(t){console.error("Error initializing ".concat(e," mode:"),t)}}else console.error("Container not found for mode: ".concat(e))}},{key:"open",value:function(){document.body.style.overflow="hidden",this.panelContainer.classList.add("active"),window.KiaanVoiceOrb&&window.KiaanVoiceOrb.orb&&window.KiaanVoiceOrb.orb.hideOrb(),!this.modeInstances[this.activeMode]&&this.config&&this.initializeMode(this.activeMode)}},{key:"close",value:function(){document.body.style.overflow="",this.panelContainer.classList.remove("active"),window.KiaanVoiceOrb&&window.KiaanVoiceOrb.orb&&window.KiaanVoiceOrb.orb.showOrb()}},{key:"switchMode",value:function(e){console.log("Switching to mode: ".concat(e)),this.panel.querySelectorAll(".kiaan-panel-tab").forEach((function(t){t.dataset.mode===e?t.classList.add("active"):t.classList.remove("active")})),this.panel.querySelectorAll(".kiaan-mode").forEach((function(t){t.id==="kiaan-".concat(e,"-mode")?t.classList.add("active"):t.classList.remove("active")})),this.activeMode=e,this.modeInstances[e]||this.initializeMode(e)}}],t&&z(e.prototype,t),n&&z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_(i.key),i)}}function _(e){var t=function(e,t){if("object"!=F(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=F(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==F(t)?t:t+""}var B=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.orb=null,this.panel=null,this.config=null,this.version="1.0.0",this.isProduction=!0},t=[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.configUrl,i=t.config;if(this.log("Kiaan Voice Orb v".concat(this.version," initializing...")),this.log("Environment: ".concat(this.isProduction?"Production":"Development")),this.orb=new a,this.panel=new U,this.orb.setClickHandler((function(){e.panel.open()})),i)this.log("Using provided config"),this.config=i,this.panel.setConfig(i);else if(n)this.fetchConfig(n);else{var o={agents:{chat:{id:"dummy-chat-id",voice_id:"voice-id-a"},meeting:{id:"dummy-meeting-id",voice_id:"voice-id-b"}},webhooks:{text_chat:"https://httpbin.org/post",file_upload:"https://httpbin.org/post"},devMode:!this.isProduction};this.log("Using dummy config with development mode:",!this.isProduction),this.panel.setConfig(o)}return window.addEventListener("resize",(function(){e.orb&&e.orb.handleResize()})),this.log("Kiaan Voice Orb initialized successfully"),this}},{key:"log",value:function(e){for(var t,n=(new Date).toISOString(),i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];(t=console).log.apply(t,["[".concat(n,"] [KiaanVoiceOrb]"),e].concat(o))}},{key:"fetchConfig",value:function(e){var t=this;this.log("Fetching configuration from:",e),fetch(e).then((function(e){if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return e.json()})).then((function(e){t.log("Configuration loaded successfully"),t.config=e,t.initializeWithConfig(e)})).catch((function(e){t.log("Failed to load Kiaan Voice Orb config:",e)}))}},{key:"initializeWithConfig",value:function(e){this.panel.setConfig(e),this.log("Kiaan Voice Orb initialized with config:",e)}}],t&&R(e.prototype,t),n&&R(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}());window.KiaanVoiceOrb=B;const W=B;return t=t.default})()));